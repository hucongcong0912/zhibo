!function(){function t(t){return!(!t||!s.test(t))}function e(t,e){this.dataCache={},this.hidden=!0,this.index=null,this.jqInput=t,this.jqSug=null,this.jqItems=null,this.jqCurItem=null,this.onInput=$.Callbacks(),this.onNav=$.Callbacks(),this.onSelect=$.Callbacks(),this.options=$.extend({delay:200,dataTimeout:2e3,navThrottle:32,triggerOnFocus:!0,submitOnEnter:!0,wrapper:'<div class="search-suggest"></div>',template:null,itemSelector:"li[data-sug-item]",curItemClass:"suggest-cur-item",dataSource:null,offsetDelta:null,zIndex:1e3},e),this.dataSource=this.options.dataSource,this._lastVal=null,this.init()}function i(t){var e=32;return t&&t.length>e&&(t=t.substring(0,e)),t}var s=/\{\s*\[(?:native code|function)\]\s*\}/i,n=n||{mix:function(t,e,i){var s;for(s in e)i!==!0&&s in t||(t[s]=e[s]);return t},Object:t(Object.create)?function(t){return Object.create(t)}:function(){function t(){}return function(e){return t.prototype=e,new t}}(),extend:function(t,e,i,s){if(!e||!t)throw new Error("extend failed, verify dependencies");var a=e.prototype,u=n.Object(a);return t.prototype=u,u.constructor=t,t.superclass=a,t.base=e,e!=Object&&a.constructor==Object.prototype.constructor&&(a.constructor=e),i&&n.mix(u,i,!0),s&&n.mix(t,s,!0),t},Class:function(t,e,i){return n.extend(t,Object,e,i)}};e.prototype={init:function(){var t=this,e=this.options;e.template&&(this.compiledTemplate=_.template(e.template));var i=_.debounce(function(e){null==t.dataCache[e]&&e===t.val()&&t.hide()},e.dataTimeout);this._checkDataTimeout=function(e){null==t.dataCache[e]&&i(e)};var s=_.debounce(function(){var e=t._checkVal(t.val());e===!1&&t.jqItems&&t.jqItems.length>0&&t.show()},e.delay);if("oninput"in this.jqInput.get(0))this.jqInput.on("input.suggest",s);else{var n=[9,13,27,37,38,39,40];this.jqInput.on("keyup.suggest paste.suggest cut.suggest",function(t){t&&-1!==_.indexOf(n,t.keyCode)||s()})}e.triggerOnFocus&&this.jqInput.on("focus.suggest",s),e.submitOnEnter||this.jqInput.on("keydown.suggest",function(t){13==t.keyCode&&t.preventDefault()});var a=_.throttle(function(i){if(t.jqItems){var s=t.jqItems.length;if(s){var n=t.index;"up"===i?null==n?n=s-1:(n-=1,0>n&&(n=null)):"down"===i&&(null==n?n=0:(n+=1,n>s-1&&(n=null))),t.index=n,t.jqCurItem&&(t.jqCurItem.removeClass(e.curItemClass),t.jqCurItem=null),null!=n&&(t.jqCurItem=t.jqItems.eq(n).addClass(e.curItemClass)),t.hidden&&t.show(),t.onNav.fire(t.jqCurItem,n,i)}}},e.navThrottle);this.jqInput.on("keydown.suggest",function(e){switch(e.keyCode){case 13:t.jqCurItem&&t.onSelect.fire(t.jqCurItem,e);break;case 38:e.preventDefault(),a("up");break;case 40:e.preventDefault(),a("down")}}).on("keyup.suggest",function(e){27==e.keyCode&&t.hide()}),$(document).on("click.suggest focus.suggest",function(e){var i=$(e.target);i.is(t.jqInput)||t.jqSug&&i.closest(t.jqSug).length>0||t.hide()}),$(window).on("resize.suggest",function(){t.hidden||t.show()})},_checkVal:function(t){if(t===this._lastVal)return!1;var e=this;if(this.onInput.fire(t,this._lastVal),this._lastVal=t,this.dataSource){var i=this.dataSource(t,function(i){i&&(e.dataCache[t]=i,e.val()===t&&e.render(i,t))});i?(this.dataCache[t]=i,this.render(i,t)):i===!1?this._checkDataTimeout(t):this.dataCache[t]?this.render(this.dataCache[t],t):this.hide()}},val:function(){if(0==arguments.length)return $.trim(this.jqInput.val())||"";var t=arguments[0];this.jqInput.val(t),arguments[1]!==!0&&this._checkVal(t)},getLastQuery:function(){return this._lastVal||""},initItems:function(){this.index=null,this.jqCurItem=null,this.jqItems=this.jqSug.find(this.options.itemSelector)},initWrapper:function(){if(!this.jqSug){var t=this,e=this.options;this.jqSug=$(e.wrapper).hide().appendTo(document.body),"static"==this.jqSug.css("position")&&this.jqSug.css("position","absolute"),this.jqSug.css("zIndex",e.zIndex),this.jqSug.on("mouseenter",e.itemSelector,function(){t.jqCurItem&&t.jqCurItem.get(0)!=this&&t.jqCurItem.removeClass(e.curItemClass);var i=$(this);t.jqCurItem=i.addClass(e.curItemClass),t.index=t.jqItems.index(i)}).on("mouseleave",e.itemSelector,function(){t.jqCurItem&&t.jqCurItem.get(0)==this&&(t.jqCurItem.removeClass(e.curItemClass),t.jqCurItem=null,t.index=null)}).on("click",e.itemSelector,function(e){t.onSelect.fire($(this),e)})}},render:function(t){this.initWrapper(),this.compiledTemplate&&this.jqSug.html(this.compiledTemplate(t))},show:function(){if(this.jqSug){var t=this.jqInput.offset();t.top+=this.jqInput.outerHeight();var e=this.options.offsetDelta;return e&&e.x&&(t.left+=e.x),e&&e.y&&(t.top+=e.y),this.jqSug.show().offset(t),this.hidden=!1,this}},hide:function(){return this.jqSug&&this.jqSug.hide(),this.hidden=!0,this.jqCurItem&&(this.jqCurItem.removeClass(this.options.curItemClass),this.jqCurItem=null,this.index=null),this},destroy:function(){this.jqInput&&(this.jqInput.off("input.suggest keyup.suggest paste.suggest cut.suggest keydown.suggest focus.suggest"),$(document).off("click.suggest focus.suggest"),$(window).off("resize.suggest"),this.jqInput=null,this.jqSug&&(this.jqSug.remove(),this.jqSug=null))}},"undefined"==typeof window.localStorage&&(window.localStorage=function(){var t={},e=document.body;if(!e.addBehavior)return t.getItem=t.setItem=t.removeItem=t.clear=function(){},t;var i="data-userdata",s=function(t,s,n,a){e.load(i),n=e.getAttribute(i)||"",a=RegExp("\\b"+t+"\\b,?","i");var u=a.test(n)?1:0;n=s?n.replace(a,""):u?n:""===n?t:n.split(",").concat(t).join(","),e.setAttribute(i,n),e.save(i)};return e.addBehavior("#default#userData"),t.getItem=function(t){return e.load(t),e.getAttribute(t)},t.setItem=function(t,i){e.setAttribute(t,i),e.save(t),s(t)},t.removeItem=function(t){e.removeAttribute(t),e.save(t),s(t,1)},t.clear=function(){e.load(i);var t=e.getAttribute(i).split(","),s=t.length;if(""!==t[0]){for(var n=0;s>n;n++)e.removeAttribute(t[n]),e.save(t[n]);e.setAttribute(i,""),e.save(i)}},t}());var a=TT.app.main,u=location.hostname.match(/(develop|test)\..+([hd]uya\.com)$/);u&&(a=location.protocol+"//"+u[1]+".www."+u[2]);var o="//search.huya.com",r=[],c=a+"/cache10min.php?m=Search&do=getHotword&v=2",h=function(){var t="huya_search_history",e="{%SP%}",s=[],n=10,a=localStorage.getItem(t);if(a)try{s=a.split(e)}catch(u){}return{getList:function(){return s},getLength:function(){return s.length},_set:function(i){s.length=0,_.each(i,function(t){s.push(t)}),i.length>0?localStorage.setItem(t,i.join(e)):localStorage.removeItem(t)},add:function(t){if(t=i(t)){s.unshift(t);var e=_.uniq(s);e.length>n&&(e=e.slice(0,n)),this._set(e)}},remove:function(t){if(t=i(t)){var e=_.without(s,t);e.length!=s.length&&this._set(e)}},clear:function(){this._set([])}}}();window.SearchSuggest=n.extend(function(t,s){var n=this;this.historyData=h,e.call(this,t,$.extend({template:'<% if(history.length){ %><div class="his-items-wrap"><ul class="his-items"><% _.each(history,function(text){ %><li data-sug-item="<%- text %>"><a href="javascript:;" class="del-item-link"><span>x</span></a><em></em><%- checkMaxLength(text) %></li><% }) %></ul><a class="clear-his-btn" href="javascript:;">\u6e05\u7a7a\u8bb0\u5f55</a></div><% } if(history.length && suggest.length){ %><div class="his-items-line"></div><% } if(suggest.length){ %><ul class="search-items"><% _.each(suggest,function(item, i){ %><li data-sug-item="<%- item.text %>"><% if(typeof isHot != "undefined" && isHot){ %><em<% if(i<3){ %> class="top-item"<% } %>><%= i+1 %></em><% } %><%- checkMaxLength(item.text) %></li><% }) %></ul><% } %>',curItemClass:"search-item-hover",dataSource:function(t,e){if(!t)return r.length>0?e({checkMaxLength:i,history:h.getList(),suggest:r.slice(0,10-h.getLength()),isHot:!0}):$.ajax({url:c,type:"get",dataType:"jsonp",cache:!0}).success(function(t){$.each(t,function(t,e){r.push({text:e})}),e({checkMaxLength:i,history:h.getList(),suggest:r.slice(0,10-h.getLength()),isHot:!0})}),!1;var s=n.dataCache[t];return s?e(s):$.ajax(o,{data:{m:"Search","do":"getSearchContent",q:t,uid:0,v:4,typ:-5,livestate:0,rows:5},dataType:"jsonp"}).success(function(s){var a=s;if(0!==a.responseHeader.status)return!1;var u=a.response[1024].docs,o=a.response[1].docs,r=a.response[3].docs,c=a.response[122].docs,h=[];$.each(u,function(t,e){e.game_name&&h.push({text:e.game_name})}),$.each(o,function(t,e){e.game_nick&&h.push({text:e.game_nick})}),$.each(r,function(t,e){e.game_introduction&&h.push({text:e.game_introduction})}),$.each(c,function(t,e){e.title&&h.push({text:e.title})});var l=[],d=[];$.each(h,function(t,e){-1===$.inArray(e.text,d)&&(l.push(e),d.push(e.text))});var g=n.dataCache[t]={checkMaxLength:i,history:[],suggest:l.slice(0,10)};e(g)}),!1}},s)),this.onItemSelect=$.Callbacks(),this.onSelect.add(function(t,e){var i=n._getItemText(t),s=!0;"click"==e.type&&(e.preventDefault(),$(e.target).closest("a.del-item-link").length>0&&(s=!1,h.remove(i),n._rerender())),s&&n.onItemSelect.fire(t,e,i)}),this.onItemSelect.add(function(e,i,s){"click"==i.type&&(n.val(s),t.closest("form").submit())}),this.onNav.add(function(e){e&&t.val(n._getItemText(e))}),t.on("focus",function(){n._rerender()})},e,{_getItemText:function(t){var e=t.data("sug-item")||"";return"string"==typeof e?e:e.toString()},initWrapper:function(){if(!this.jqSug){e.prototype.initWrapper.call(this);var t=this;this.jqSug.on("click","a.clear-his-btn",function(e){e.preventDefault(),h.clear(),t._rerender()})}},render:function(t,i){e.prototype.render.call(this,t,i),this.initItems(),t.history.length>0||t.suggest.length>0?this.show():this.hide()},_rerender:function(){var t=this;setTimeout(function(){var e=t.val();t.dataSource(e,function(i){i&&(t.dataCache[e]=i,t.val()===e&&t.render(i,e))})},0)}})}(),function(){var t=$("#searchForm_id").find('input[type="text"]');if(0!=t.length){t.closest("form").on("submit",function(e){0==$.trim(t.val()).length&&e.preventDefault()});var e=t.closest("div.duya-header-search");if(e.length>0){var i=new SearchSuggest(t,{wrapper:'<div class="header-search-tips"></div>',offsetDelta:{x:0,y:7}});i.compiledTemplate=_.template('<i class="search-tips-icon"></i>'+i.options.template),t.closest("form").on("submit",function(){i.historyData.add(i.val())})}}}();